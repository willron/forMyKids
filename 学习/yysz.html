<html>

<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <style>
        .p1 {
            font-size: 200px;
            color: blue;
        }

        .button {
            height: 30px;
            width: 200px;
            margin: 10px auto;
        }
    </style>
</head>

<body>
    <p style="text-align: center">
        <div id="content" class="p1" style="text-align: center"></div>
    </p>
    <p style="text-align: center;display:none" id="dict">
        <span id="pingyin"></span> <br>
        <audio id="mp3" src="" controls="controls"></audio>
    </p>
    <p style="text-align: center">
        <button type="button" id="start" class="button">开始</button>
    </p>
    <p style="text-align: center">
        <button type="button" id="stop" class="button" style="display: none">停止</button>
    </p>
    <p style="text-align: center">
        <textarea name="message" rows="10" cols="30" id="input"></textarea>
    </p>
</body>

</html>

<script type="text/javascript">
    var content = document.getElementById("content");
    var startBTN = document.getElementById("start");
    var stopBTN = document.getElementById("stop");
    interval = null;

    startBTN.onclick = function () {
        document.getElementById("dict").style.display = "none";
        var words = document.getElementById("input").value.replace(/\n/g, "").split("")
        if (words != "") {
            startBTN.style.display = "none";
            stopBTN.style.display = "block";
            interval = setInterval(function () {
                var index = Math.floor(Math.random() * words.length);
                content.innerText = words[index];
            }, 1);
        } else {
            alert("请在文本框中输入待选汉字");
        }

    };

    stopBTN.onclick = function () {
        clearInterval(interval);
        var now_word = document.getElementById("content").innerText;
        stopBTN.style.display = "none";
        startBTN.style.display = "block";
        var httpRequest = new XMLHttpRequest();
        httpRequest.open('GET', 'dict/' + now_word, true);
        httpRequest.send();
        httpRequest.onreadystatechange = function () {
            if (httpRequest.readyState == 4 && httpRequest.status == 200) {
                var p = /audio="(.*\.mp3)"/;
                var mp3_url = p.exec(httpRequest.responseText)[1];
                console.log(mp3_url);
                var s = mp3_url.split("/");
                var mp3_file = s[s.length - 1];
                var word_pingyin = mp3_file.replace(".mp3", "");
                document.getElementById("pingyin").innerText = word_pingyin;
                var mp3_el = document.getElementById("mp3");
                mp3_el.setAttribute("src", mp3_url);
                document.getElementById("dict").style.display = "block";
            }
        };
    };
</script>
